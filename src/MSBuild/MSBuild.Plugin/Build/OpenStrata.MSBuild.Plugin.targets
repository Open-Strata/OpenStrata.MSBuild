<!--
***********************************************************************************************
$Rename$.props

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) Open-Strata contributors. All rights reserved.. All rights reserved.
***********************************************************************************************
-->
<Project  xmlns='http://schemas.microsoft.com/developer/msbuild/2003' >

	<PropertyGroup Condition="'$(OpenStrataBuildSolutionAssemblyFile)' == ''">
		<OpenStrataBuildPluginAssemblyFile>$(MSBuildThisFileDirectory)..\tasks\OpenStrata.MSBuild.Plugin.dll</OpenStrataBuildPluginAssemblyFile>
		<MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
	</PropertyGroup>

	<UsingTask TaskName="OpenStrata.MSBuild.Plugin.Tasks.UpdatePluginPackageXml" AssemblyFile="$(OpenStrataBuildPluginAssemblyFile)"     TaskFactory="TaskHostFactory" />

	<Target Name="GetPluginPackageInfo" DependsOnTargets="FixMergeDiffVersionMarkup;Build;">


		<PropertyGroup>
			<FinalPackagePrefix>$(SolutionPublisherPrefix)</FinalPackagePrefix>
			<FinalPackagePrefix Condition="'$(AltPackagePrefix)' != ''">$(AltPackagePrefix)</FinalPackagePrefix>
			<pluginfile>$(PackageOutputAbsolutePath)$(PackageId).$(PackageVersion).nupkg</pluginfile>
			<PluginPackageUniqueName>$(FinalPackagePrefix)_$(PackageId)</PluginPackageUniqueName>
			<metaPluginPackageDir>$(SolutionMetadataDir)\pluginpackages\$(PluginPackageUniqueName)</metaPluginPackageDir>
			<metaPluginPackageFileDir>$(metaPluginPackageDir)\package</metaPluginPackageFileDir>
			<targetMetaFile>$(metaPluginPackageFileDir)\$(PluginPackageUniqueName).nupkg</targetMetaFile>
		</PropertyGroup>

		<UpdatePluginPackageXml XmlFilePath="$(ProjectDir)pluginpackage.xml" 
								uniquename="$(PluginPackageUniqueName)" 
								pluginpackageid="$(PluginId)" 
								name="$(PluginPackageUniqueName)" 
								package="$(PluginPackageUniqueName).nupkg" 
								version="$(Version)" 
								AutoUpdateVersion="$(AutoUpdateVersion)"/>

		<MakeDir Directories="$(metaPluginPackageDir)" Condition="!Exists('$(metaPluginPackageDir)')" />
		<MakeDir Directories="$(metaPluginPackageFileDir)" Condition="!Exists('$(metaPluginPackageFileDir)')" />

		<Copy SourceFiles="$(ProjectDir)pluginpackage.xml" DestinationFolder="$(metaPluginPackageDir)" />

		<Copy SourceFiles="$(pluginfile)" DestinationFiles="$(targetMetaFile)" />

	</Target>


</Project>
