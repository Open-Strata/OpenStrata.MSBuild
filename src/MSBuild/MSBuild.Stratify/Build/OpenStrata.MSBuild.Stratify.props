<!--
***********************************************************************************************
OpenStrata.MSBuild.Package.props

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) 74Bravo LLC and Contributors. All rights reserved.. All rights reserved.
***********************************************************************************************
-->
<Project  xmlns='http://schemas.microsoft.com/developer/msbuild/2003' >


	<PropertyGroup Label='OpenStrata Project Properties'>
		<OpenStrataProjectType Condition="'$(OpenStrataProjectType)' == ''">strati</OpenStrataProjectType>
		<RestatifyDuplicateProjectTypes Condition="'$(RestatifyDuplicateProjectTypes)' != '' AND '$(OpenStrataProjectType)' != 'strati' ">true</RestatifyDuplicateProjectTypes>
		<PackageNameSuffix>Strati</PackageNameSuffix>
		<IsPackable>true</IsPackable>

		<ostrataNugetPackageFolder>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)..'))</ostrataNugetPackageFolder>
		<ostrataStratifyVersion>$([System.IO.Path]::GetFileName($(ostrataNugetPackageFolder)))</ostrataStratifyVersion>

	</PropertyGroup>

	<ItemGroup>
		<None Include="strati.props" Pack="true" PackagePath="\build;\buildTransitive;\buildMultiTargeting;" Condition="Exists('strati.props')" />
		<None Include="strati.targets" Pack="true" PackagePath="\build;\buildTransitive;\buildMultiTargeting;" Condition="Exists('strati.targets')" />
		<None Include="strati.*.targets" Pack="true" PackagePath="\build;\buildTransitive;\buildMultiTargeting;" />
	</ItemGroup>

	<PropertyGroup>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<DelayCreationOfNugetPackage>true</DelayCreationOfNugetPackage>
		<SuppressDependenciesWhenPacking>true</SuppressDependenciesWhenPacking>
		
		
		
		

		<!--In order for the transitive behavior to work, the development dependency cannot be true.-->
		<DevelopmentDependency>false</DevelopmentDependency>
		<!--<IncludeBuildOutput>false</IncludeBuildOutput>-->
		<IsTool>true</IsTool>		
		
		
		<GenerateNuspecDependsOn>
			CreateStrati;
			$(GenerateNuspecDependsOn)
		</GenerateNuspecDependsOn>

		<CreateStratiDependsOn>
			GenerateBuildTransitiveProps;
			GenerateStratiManifest;
			GetStratiFiles;
			$(CreateStratiDependsOn)
		</CreateStratiDependsOn>

		<DelayedPackageCreationDependsOn>
			AddTransitiveStratiPackageReferencesToNuspec;
			$(DelayedPackageCreationDependsOn)
		</DelayedPackageCreationDependsOn>



	</PropertyGroup>

	<ItemGroup>
		<OpenStrataProject Include="$(MSBuildProjectFullPath)">
			<OpenStrataProjectType>strati</OpenStrataProjectType>
			<ProjectName>$(MSBuildProjectName)</ProjectName>
		</OpenStrataProject>
	</ItemGroup>

	<PropertyGroup>

		<!-- This target will run when MSBuild is collecting the files to be packaged, and we'll implement it below. This property controls the dependency list for this packaging process, so by adding our custom property we hook ourselves into the process in a supported way. -->
		<TargetsForTfmSpecificBuildOutput>
			$(TargetsForTfmSpecificBuildOutput)
		</TargetsForTfmSpecificBuildOutput>
		<!-- This property tells MSBuild where the root folder of the package's build assets should be. Because we are not a library package, we should not pack to 'lib'. Instead, we choose 'tasks' by convention. -->
		<BuildOutputTargetFolder>tasks</BuildOutputTargetFolder>
		<!-- NuGet does validation that libraries in a package are exposed as dependencies, but we _explicitly_ do not want that behavior for MSBuild tasks. They are isolated by design. Therefore we ignore this specific warning. -->
	</PropertyGroup>


	<PropertyGroup>
		<GenerateNuspecDependsOn>StratiUpdatePackageReferenceRequiredForInstall; $(GenerateNuspecDependsOn)</GenerateNuspecDependsOn>
	</PropertyGroup>


	<Target Name="StratiUpdatePackageReferenceRequiredForInstall" DependsOnTargets="SetVersionInfo" />

</Project>
