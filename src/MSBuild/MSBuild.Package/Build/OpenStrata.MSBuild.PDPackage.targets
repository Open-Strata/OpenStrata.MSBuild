<!--
***********************************************************************************************
OpenStrata.MSBuild.PDPackage.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) 74Bravo LLC and Contributors. All rights reserved.. All rights reserved.
***********************************************************************************************
-->
<Project  xmlns='http://schemas.microsoft.com/developer/msbuild/2003' >


	<PropertyGroup>

	   <PDPublishOnBuild Condition="'$(PDPublishOnBuild)'==''">true</PDPublishOnBuild>

		<!-- <AssignTargetPathsDependsOn>$(AssignTargetPathsDependsOn);AssignStratiTargetPaths;</AssignTargetPathsDependsOn> -->
	</PropertyGroup>


	<Target Name="PDPublishOnBuild" AfterTargets="Build" DependsOnTargets="Publish" Condition="'$(PDPublishOnBuild)'=='true'" />


	<ItemGroup>
		<PowerPlatformPDPackageReference Include="@(PackageReference->WithMetadataValue('Identity', 'Microsoft.PowerApps.MSBuild.PDPackage'))" />
	</ItemGroup>


	<Target Name="AssignStratiTargetPaths" BeforeTargets="AssignTargetPaths" >

		<Warning Text="MSPA_Build_PDPackage_Installed = $(MSPA_Build_PDPackage_Installed)" />
		<Warning Text="PowerPlatformPDPackageReference.Identity = %(PowerPlatformPDPackageReference.Identity)" />

		<ItemGroup>
			<ContentWithTargetPath Include="@(StratiPackageFiles->WithMetadataValue('PackageLocation', 'root'))">
				<TargetPath>%(StratiPackageFiles.RelativePublishPath)</TargetPath>
				<CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
				<CopyToOutputDirectory>Never</CopyToOutputDirectory>
				<OriginalItemSpec>%(StratiPackageFiles.Identity)</OriginalItemSpec>
			</ContentWithTargetPath>
		</ItemGroup>

		<ItemGroup>
			<ContentWithTargetPath Include="@(StratiPackageFiles->WithMetadataValue('PackageLocation', 'configdata'))">
				<TargetPath>$(PdAssetsTargetFolder)\%(StratiPackageFiles.RelativePublishPath)</TargetPath>
				<CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
				<CopyToOutputDirectory>Never</CopyToOutputDirectory>
				<OriginalItemSpec>%(StratiPackageFiles.Identity)</OriginalItemSpec>
			</ContentWithTargetPath>
		</ItemGroup>

	</Target>




</Project>
